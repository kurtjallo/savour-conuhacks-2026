---
phase: 09-price-history-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/models.py
  - backend/scripts/seed_db.py
  - backend/main.py
autonomous: true

must_haves:
  truths:
    - "Category API responses include previous_price field"
    - "All 15 categories have sample previous prices in database"
    - "Previous price is higher than current cheapest price (realistic data)"
  artifacts:
    - path: "backend/models.py"
      provides: "previous_price field in CategorySummary and CategoryDetail"
      contains: "previous_price: Optional[float]"
    - path: "backend/scripts/seed_db.py"
      provides: "previous_price values for all categories"
      contains: "previous_price"
    - path: "backend/main.py"
      provides: "previous_price included in API responses"
      contains: "previous_price"
  key_links:
    - from: "backend/main.py"
      to: "database category document"
      via: "cat.get('previous_price')"
      pattern: "previous_price.*cat\\.get"
---

<objective>
Add price history tracking by introducing previous_price field to the category data model.

Purpose: Enable the frontend to display price changes (strikethrough styling on old prices) showing users how much prices have changed.

Output: Database categories have previous_price field, API returns it in responses.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

# Key files to modify
@backend/models.py
@backend/scripts/seed_db.py
@backend/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add previous_price to models and seed data</name>
  <files>backend/models.py, backend/scripts/seed_db.py</files>
  <action>
1. In backend/models.py:
   - Add `previous_price: Optional[float] = None` to CategorySummary model (after most_expensive_price)
   - Add `previous_price: Optional[float] = None` to CategoryDetail model (after image_url)

2. In backend/scripts/seed_db.py:
   - Add `previous_price` field to each category in CATEGORIES list
   - Previous price should be 10-25% higher than the most expensive current price (realistic inflation scenario)
   - Example calculation: if most_expensive_price is 5.49, previous_price could be 5.99 or 6.29

Sample previous_price values (use these exact values):
- eggs: 5.99 (was more expensive before)
- milk: 6.99
- bread: 3.79
- butter: 7.49
- apples: 2.29
- bananas: 0.89
- potatoes: 7.49
- onions: 4.29
- chicken: 16.99
- ground-beef: 14.49
- pasta: 3.29
- rice: 6.49
- cheese: 8.49
- canned-tomatoes: 2.29
- cereal: 6.49
- yogurt: 5.49
- orange-juice: 5.99
- coffee: 11.99
- sugar: 4.99
- flour: 5.99
- cooking-oil: 5.79
- frozen-pizza: 8.49
- ice-cream: 6.99
- bacon: 9.49
- lettuce: 3.79
  </action>
  <verify>
- Run `python -c "from models import CategorySummary, CategoryDetail; print('Models OK')"` in backend/
- Verify seed_db.py has previous_price in all 25 category entries
  </verify>
  <done>
- CategorySummary and CategoryDetail models have previous_price field
- All categories in seed script have previous_price values
  </done>
</task>

<task type="auto">
  <name>Task 2: Update API to return previous_price and reseed database</name>
  <files>backend/main.py</files>
  <action>
1. In backend/main.py, update get_categories() endpoint:
   - Add `previous_price=cat.get("previous_price")` to CategorySummary constructor (around line 58-68)

2. Update search_categories() endpoint similarly:
   - Add `previous_price=cat.get("previous_price")` to CategorySummary constructor (around line 95-105)

3. Update get_category() endpoint:
   - Add `previous_price=category.get("previous_price")` to CategoryDetail constructor (around line 139-148)

4. Run the seed script to populate database with new data:
   ```bash
   cd backend && python scripts/seed_db.py
   ```

5. Test the API returns previous_price:
   ```bash
   curl http://localhost:8000/api/categories | python -m json.tool | head -30
   ```
  </action>
  <verify>
- Start server: `cd backend && uvicorn main:app --reload`
- Test: `curl -s http://localhost:8000/api/categories | grep previous_price`
- Test single category: `curl -s http://localhost:8000/api/categories/eggs | grep previous_price`
- Both should show previous_price field with numeric values
  </verify>
  <done>
- GET /api/categories returns previous_price for each category
- GET /api/categories/{id} returns previous_price
- GET /api/categories/search returns previous_price
- Database contains previous_price for all 25 categories
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Model verification:
```bash
cd backend && python -c "from models import CategorySummary; print(CategorySummary.model_fields.keys())"
```
Should include 'previous_price'

2. Database verification:
```bash
cd backend && python -c "
from pymongo import MongoClient
import certifi
import os
from dotenv import load_dotenv
load_dotenv()
client = MongoClient(os.getenv('MONGODB_URI'), tlsCAFile=certifi.where())
db = client.inflationfighter
cat = db.categories.find_one({'category_id': 'eggs'})
print(f'Eggs previous_price: {cat.get(\"previous_price\")}')"
```

3. API verification:
```bash
curl -s http://localhost:8000/api/categories/eggs | python -m json.tool
```
Should show previous_price field in response
</verification>

<success_criteria>
1. CategorySummary model has previous_price: Optional[float] field
2. CategoryDetail model has previous_price: Optional[float] field
3. All 25 categories in seed_db.py have previous_price values
4. Database contains previous_price for all categories after seeding
5. GET /api/categories returns previous_price in each category
6. GET /api/categories/{id} returns previous_price
7. GET /api/categories/search returns previous_price
</success_criteria>

<output>
After completion, create `.planning/phases/09-price-history-data/09-01-SUMMARY.md`
</output>
